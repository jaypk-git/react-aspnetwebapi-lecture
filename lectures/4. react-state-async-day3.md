# React 3일차: 상태 관리와 비동기 처리

# React Query

React Query는 서버 상태를 관리하기 위한 강력한 라이브러리입니다. 데이터 fetching, 캐싱, 동기화, 업데이트를 쉽게 할 수 있게 해줍니다.

## 1. React Query 설정

먼저 React Query를 설치합니다:

```bash
npm install @tanstack/react-query
# 또는
pnpm add @tanstack/react-query
```

그리고 애플리케이션에 React Query를 설정합니다:

```jsx
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'

const queryClient = new QueryClient()

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      {/* 여기에 애플리케이션 컴포넌트들 */}
    </QueryClientProvider>
  )
}
```

## 2. useQuery 훅

`useQuery` 훅은 데이터를 가져오는 데 사용됩니다:

```jsx
import { useQuery } from '@tanstack/react-query'

function Example() {
  const { isLoading, error, data } = useQuery({
    queryKey: ['repoData'],
    queryFn: () =>
      fetch('https://api.github.com/repos/tannerlinsley/react-query').then(
        (res) => res.json(),
      ),
  })

  if (isLoading) return 'Loading...'

  if (error) return 'An error has occurred: ' + error.message

  return (
    <div>
      <h1>{data.name}</h1>
      <p>{data.description}</p>
      <strong>👀 {data.subscribers_count}</strong>{' '}
      <strong>✨ {data.stargazers_count}</strong>{' '}
      <strong>🍴 {data.forks_count}</strong>
    </div>
  )
}
```

## 3. useMutation 훅

`useMutation` 훅은 데이터를 생성/수정/삭제하는 데 사용됩니다:

```jsx
import { useMutation } from '@tanstack/react-query'

function Example() {
  const mutation = useMutation({
    mutationFn: (newTodo) => {
      return fetch('/api/todo', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(newTodo),
      }).then(res => res.json())
    },
  })

  return (
    <div>
      {mutation.isLoading ? (
        'Adding todo...'
      ) : (
        <>
          {mutation.isError ? (
            <div>An error occurred: {mutation.error.message}</div>
          ) : null}

          {mutation.isSuccess ? <div>Todo added!</div> : null}

          <button
            onClick={() => {
              mutation.mutate({ id: new Date(), title: 'Do Laundry' })
            }}
          >
            Create Todo
          </button>
        </>
      )}
    </div>
  )
}
```

## 4. 쿼리 무효화

데이터가 stale 되었을 때 쿼리를 무효화할 수 있습니다:

```jsx
import { useQueryClient } from '@tanstack/react-query'

const queryClient = useQueryClient()

queryClient.invalidateQueries({ queryKey: ['todos'] })
```

## 5. 쿼리 프리페칭

사용자 경험을 개선하기 위해 데이터를 미리 가져올 수 있습니다:

```jsx
const prefetchTodos = async () => {
  await queryClient.prefetchQuery({
    queryKey: ['todos'],
    queryFn: fetchTodos,
  })
}
```

## 6. Query Keys

Query Key는 쿼리를 고유하게 식별하는 데 사용됩니다:

```jsx
// 문자열 키
useQuery({ queryKey: ['todos'], ... })

// 배열 키
useQuery({ queryKey: ['todo', 5], ... })

// 객체를 포함한 배열 키
useQuery({ queryKey: ['todos', { status, page }], ... })
```

이러한 React Query의 주요 기능들을 이해하고 활용하면, 서버 상태 관리를 더욱 효과적으로 할 수 있습니다.




