# React 3ì¼ì°¨: ìƒíƒœ ê´€ë¦¬ì™€ ë¹„ë™ê¸° ì²˜ë¦¬

# React Query

React QueryëŠ” ì„œë²„ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ê°•ë ¥í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. ë°ì´í„° fetching, ìºì‹±, ë™ê¸°í™”, ì—…ë°ì´íŠ¸ë¥¼ ì‰½ê²Œ í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

## 1. React Query ì„¤ì •

ë¨¼ì € React Queryë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤:

```bash
npm install @tanstack/react-query
# ë˜ëŠ”
pnpm add @tanstack/react-query
```

ê·¸ë¦¬ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì— React Queryë¥¼ ì„¤ì •í•©ë‹ˆë‹¤:

```jsx
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'

const queryClient = new QueryClient()

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      {/* ì—¬ê¸°ì— ì• í”Œë¦¬ì¼€ì´ì…˜ ì»´í¬ë„ŒíŠ¸ë“¤ */}
    </QueryClientProvider>
  )
}
```

## 2. useQuery í›…

`useQuery` í›…ì€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤:

```jsx
import { useQuery } from '@tanstack/react-query'

function Example() {
  const { isLoading, error, data } = useQuery({
    queryKey: ['repoData'],
    queryFn: () =>
      fetch('https://api.github.com/repos/tannerlinsley/react-query').then(
        (res) => res.json(),
      ),
  })

  if (isLoading) return 'Loading...'

  if (error) return 'An error has occurred: ' + error.message

  return (
    <div>
      <h1>{data.name}</h1>
      <p>{data.description}</p>
      <strong>ğŸ‘€ {data.subscribers_count}</strong>{' '}
      <strong>âœ¨ {data.stargazers_count}</strong>{' '}
      <strong>ğŸ´ {data.forks_count}</strong>
    </div>
  )
}
```

## 3. useMutation í›…

`useMutation` í›…ì€ ë°ì´í„°ë¥¼ ìƒì„±/ìˆ˜ì •/ì‚­ì œí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤:

```jsx
import { useMutation } from '@tanstack/react-query'

function Example() {
  const mutation = useMutation({
    mutationFn: (newTodo) => {
      return fetch('/api/todo', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(newTodo),
      }).then(res => res.json())
    },
  })

  return (
    <div>
      {mutation.isLoading ? (
        'Adding todo...'
      ) : (
        <>
          {mutation.isError ? (
            <div>An error occurred: {mutation.error.message}</div>
          ) : null}

          {mutation.isSuccess ? <div>Todo added!</div> : null}

          <button
            onClick={() => {
              mutation.mutate({ id: new Date(), title: 'Do Laundry' })
            }}
          >
            Create Todo
          </button>
        </>
      )}
    </div>
  )
}
```

## 4. ì¿¼ë¦¬ ë¬´íš¨í™”

ë°ì´í„°ê°€ stale ë˜ì—ˆì„ ë•Œ ì¿¼ë¦¬ë¥¼ ë¬´íš¨í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```jsx
import { useQueryClient } from '@tanstack/react-query'

const queryClient = useQueryClient()

queryClient.invalidateQueries({ queryKey: ['todos'] })
```

## 5. ì¿¼ë¦¬ í”„ë¦¬í˜ì¹­

ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•˜ê¸° ìœ„í•´ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```jsx
const prefetchTodos = async () => {
  await queryClient.prefetchQuery({
    queryKey: ['todos'],
    queryFn: fetchTodos,
  })
}
```

## 6. Query Keys

Query KeyëŠ” ì¿¼ë¦¬ë¥¼ ê³ ìœ í•˜ê²Œ ì‹ë³„í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤:

```jsx
// ë¬¸ìì—´ í‚¤
useQuery({ queryKey: ['todos'], ... })

// ë°°ì—´ í‚¤
useQuery({ queryKey: ['todo', 5], ... })

// ê°ì²´ë¥¼ í¬í•¨í•œ ë°°ì—´ í‚¤
useQuery({ queryKey: ['todos', { status, page }], ... })
```

ì´ëŸ¬í•œ React Queryì˜ ì£¼ìš” ê¸°ëŠ¥ë“¤ì„ ì´í•´í•˜ê³  í™œìš©í•˜ë©´, ì„œë²„ ìƒíƒœ ê´€ë¦¬ë¥¼ ë”ìš± íš¨ê³¼ì ìœ¼ë¡œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.




