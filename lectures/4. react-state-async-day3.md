# React 3일차: 상태 관리와 비동기 처리

# React Query

React Query는 서버 상태를 관리하기 위한 강력한 라이브러리입니다. 데이터 fetching, 캐싱, 동기화, 업데이트를 쉽게 할 수 있게 해줍니다.

## 1. React Query 설정

먼저 React Query를 설치합니다:

```bash
npm install @tanstack/react-query
# 또는
pnpm add @tanstack/react-query
```

그리고 애플리케이션에 React Query를 설정합니다:

```jsx
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'

const queryClient = new QueryClient()

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      {/* 여기에 애플리케이션 컴포넌트들 */}
    </QueryClientProvider>
  )
}
```

## 2. useQuery 훅

`useQuery` 훅은 데이터를 가져오는 데 사용됩니다:

```jsx
import { useQuery } from '@tanstack/react-query'

function Example() {
  const { isLoading, error, data } = useQuery({
    queryKey: ['repoData'],
    queryFn: () =>
      fetch('https://api.github.com/repos/tannerlinsley/react-query').then(
        (res) => res.json(),
      ),
  })

  if (isLoading) return 'Loading...'

  if (error) return 'An error has occurred: ' + error.message

  return (
    <div>
      <h1>{data.name}</h1>
      <p>{data.description}</p>
      <strong>👀 {data.subscribers_count}</strong>{' '}
      <strong>✨ {data.stargazers_count}</strong>{' '}
      <strong>🍴 {data.forks_count}</strong>
    </div>
  )
}
```

## 3. useMutation 훅

`useMutation` 훅은 데이터를 생성/수정/삭제하는 데 사용됩니다:

```jsx
import { useMutation } from '@tanstack/react-query'

function Example() {
  const mutation = useMutation({
    mutationFn: (newTodo) => {
      return fetch('/api/todo', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(newTodo),
      }).then(res => res.json())
    },
  })

  return (
    <div>
      {mutation.isLoading ? (
        'Adding todo...'
      ) : (
        <>
          {mutation.isError ? (
            <div>An error occurred: {mutation.error.message}</div>
          ) : null}

          {mutation.isSuccess ? <div>Todo added!</div> : null}

          <button
            onClick={() => {
              mutation.mutate({ id: new Date(), title: 'Do Laundry' })
            }}
          >
            Create Todo
          </button>
        </>
      )}
    </div>
  )
}
```

## 4. 쿼리 무효화

데이터가 stale 되었을 때 쿼리를 무효화할 수 있습니다:

```jsx
import { useQueryClient } from '@tanstack/react-query'

const queryClient = useQueryClient()

queryClient.invalidateQueries({ queryKey: ['todos'] })
```

## 5. 쿼리 프리페칭

사용자 경험을 개선하기 위해 데이터를 미리 가져올 수 있습니다:

```jsx
const prefetchTodos = async () => {
  await queryClient.prefetchQuery({
    queryKey: ['todos'],
    queryFn: fetchTodos,
  })
}
```

## 6. Query Keys

Query Key는 쿼리를 고유하게 식별하는 데 사용됩니다:

```jsx
// 문자열 키
useQuery({ queryKey: ['todos'], ... })

// 배열 키
useQuery({ queryKey: ['todo', 5], ... })

// 객체를 포함한 배열 키
useQuery({ queryKey: ['todos', { status, page }], ... })
```

# React Router

## 1. React Router 소개

React Router는 React 애플리케이션에서 라우팅을 구현하기 위한 표준 라이브러리입니다. 이를 통해 단일 페이지 애플리케이션(SPA)에서 여러 "페이지"를 구현할 수 있습니다.

### 주요 특징:
- 선언적 라우팅
- 동적 라우트 매칭
- 중첩 라우팅 지원
- 히스토리 관리

### 설치:
```bash
npm install react-router-dom
```

## 2. 기본 컴포넌트

### BrowserRouter
HTML5 history API를 사용하여 UI를 URL과 동기화합니다.

```jsx
import { BrowserRouter } from 'react-router-dom';

function App() {
  return (
    <BrowserRouter>
      {/* 라우트 정의 */}
    </BrowserRouter>
  );
}
```

### Route
URL과 컴포넌트를 매핑합니다.

```jsx
import { Route } from 'react-router-dom';

<Route path="/about" component={About} />
```

### Link
선언적이고 접근성이 있는 네비게이션을 제공합니다.

```jsx
import { Link } from 'react-router-dom';

<Link to="/about">About</Link>
```

### Switch
매칭되는 첫 번째 라우트만 렌더링합니다.

```jsx
import { Switch, Route } from 'react-router-dom';

<Switch>
  <Route exact path="/" component={Home} />
  <Route path="/about" component={About} />
  <Route path="*" component={NotFound} />
</Switch>
```

## 3. 동적 라우팅

URL 파라미터를 사용하여 동적 라우팅을 구현할 수 있습니다.

```jsx
<Route path="/users/:id" component={User} />
```

useParams 훅을 사용하여 파라미터에 접근:

```jsx
import { useParams } from 'react-router-dom';

function User() {
  let { id } = useParams();
  return <div>User ID: {id}</div>;
}
```

## 4. 프로그래매틱 네비게이션

useHistory 훅을 사용하여 프로그래밍 방식으로 네비게이션을 수행할 수 있습니다.

```jsx
import { useHistory } from 'react-router-dom';

function HomeButton() {
  let history = useHistory();

  function handleClick() {
    history.push('/home');
  }

  return (
    <button type="button" onClick={handleClick}>
      Go home
    </button>
  );
}
```

## 5. 인증 라우팅

인증이 필요한 라우트를 보호하기 위해 커스텀 Route 컴포넌트를 만들 수 있습니다.

```jsx
function PrivateRoute({ component: Component, ...rest }) {
  return (
    <Route
      {...rest}
      render={props =>
        isAuthenticated ? (
          <Component {...props} />
        ) : (
          <Redirect to="/login" />
        )
      }
    />
  );
}

// 사용
<PrivateRoute path="/dashboard" component={Dashboard} />
```

## 7. 쿼리 파라미터 처리

useLocation 훅을 사용하여 쿼리 파라미터를 처리할 수 있습니다.

```jsx
import { useLocation } from 'react-router-dom';

function useQuery() {
  return new URLSearchParams(useLocation().search);
}

function SearchResults() {
  let query = useQuery();
  return <div>Search results for: {query.get('q')}</div>;
}
```

## 8. 전체 예제

```jsx
import React from 'react';
import {
  BrowserRouter as Router,
  Switch,
  Route,
  Link,
  useParams,
  useRouteMatch,
  useHistory,
  useLocation
} from 'react-router-dom';

// Home 컴포넌트
const Home = () => <h2>Home Page</h2>;

// About 컴포넌트
const About = () => <h2>About Page</h2>;

// User 컴포넌트 (동적 라우팅 예시)
const User = () => {
  let { id } = useParams();
  return <h2>User: {id}</h2>;
};

// Users 컴포넌트 (중첩 라우팅 예시)
const Users = () => {
  let { path, url } = useRouteMatch();
  return (
    <div>
      <h2>Users</h2>
      <ul>
        <li>
          <Link to={`${url}/1`}>User 1</Link>
        </li>
        <li>
          <Link to={`${url}/2`}>User 2</Link>
        </li>
      </ul>

      <Switch>
        <Route exact path={path}>
          <h3>Please select a user.</h3>
        </Route>
        <Route path={`${path}/:userId`}>
          <User />
        </Route>
      </Switch>
    </div>
  );
};

// SearchResults 컴포넌트 (쿼리 파라미터 처리 예시)
const SearchResults = () => {
  let query = new URLSearchParams(useLocation().search);
  return <h2>Search results for: {query.get('q')}</h2>;
};

// 메인 App 컴포넌트
function App() {
  let history = useHistory();

  return (
    <Router>
      <div>
        <nav>
          <ul>
            <li><Link to="/">Home</Link></li>
            <li><Link to="/about">About</Link></li>
            <li><Link to="/users">Users</Link></li>
            <li><Link to="/search?q=react">Search</Link></li>
          </ul>
        </nav>

        <button onClick={() => history.push('/about')}>Go to About</button>

        <Switch>
          <Route path="/" exact component={Home} />
          <Route path="/about" component={About} />
          <Route path="/users" component={Users} />
          <Route path="/search" component={SearchResults} />
        </Switch>
      </div>
    </Router>
  );
}

export default App;
```


## 실습 과제

1. 위의 예제를 기반으로 새로운 페이지 (예: Contact)를 추가해보세요.
2. 사용자 목록 페이지를 만들고, 각 사용자의 상세 정보 페이지로 이동하는 링크를 구현해보세요.
3. 404 Not Found 페이지를 만들고, 정의되지 않은 라우트에 대해 이 페이지가 표시되도록 구현해보세요.


